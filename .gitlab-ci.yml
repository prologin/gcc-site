stages:
  - lint
  - build

# Lints the API with black
api-lint:
  stage: lint

  image: "python:3.10-bullseye"

  allow_failure: true

  before_script:
    - pip install pre-commit
    - cd api

  script:
    - pre-commit run -a

# Tests that yarn install and yarn build are successful
test-yarn:
  stage: build

  image:
    name: j4m3s/gcc-build:17.9-alpine3.14
    entrypoint: [""]

  variables:
    # Without this it will not work
    # Note that this is not a problem for production since SSL is not handled by
    # the front and we're only building static assets
    NODE_OPTIONS: "--openssl-legacy-provider"

  before_script:
    - cd front

  script:
    - yarn install
    - yarn build

  cache:
    key: gcc-yarn
    paths:
      - front/node_modules/

  rules:
    - changes:
        - front/yarn.lock
    - exists:
        - front/node_modules
